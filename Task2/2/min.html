<!doctype html>
<html lang="en">
	<head>
		<title>WebGL made easy</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background:#000;
				padding:0;
				margin:0;
				overflow:hidden;
				font-family:'trebuchet ms', 'lucida grande', 'lucida sans unicode', arial, helvetica, sans-serif;
				text-align:center;
			}
			canvas { pointer-events:none; z-index:10; }
			
			p { font-size: small;}

		</style>
	</head>

	<body>


		<script src="../../js/detector.js"></script>
		<script src="../../js/three.js"></script>
		
		<script src="../../js/raf.js"></script>
		<script src="../../js/jquery-1.8.2.js"></script>

		<script>
			if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

			var SCREEN_WIDTH = window.innerWidth;
			var SCREEN_HEIGHT = window.innerHeight;
			var FLOOR = 0;

			var container;

			var camera, scene;
			var webglRenderer;

			var zmeshArray = [];
			var mouseX = 0, mouseY = 0;

			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;

			var vShader = $('#vertexshader');
			var fShader = $('#fragmentshader');

			// camera
			var camera = new THREE.PerspectiveCamera( 45, SCREEN_WIDTH / SCREEN_HEIGHT, 1, 10000 );
			camera.position.z = 300;


			document.addEventListener( 'mousemove', onDocumentMouseMove, false );

			init();
			animate();
		

			function init() {

				container = document.createElement( 'div' );
				document.body.appendChild( container );

				//scene
				scene = new THREE.Scene();

				// lights
				//var ambient = new THREE.AmbientLight( 0x00000000 );
				//scene.add( ambient );

				// more lights
				var directionalLight = new THREE.DirectionalLight( 0xffeedd );
				directionalLight.position.set( 0, -70, 100 ).normalize();
				scene.add( directionalLight );
				
				// renderer
				webglRenderer = new THREE.WebGLRenderer( { antialias: true } );
				webglRenderer.setSize( SCREEN_WIDTH, SCREEN_HEIGHT );
				webglRenderer.domElement.style.position = "relative";
				container.appendChild( webglRenderer.domElement );
				
				// loader
				loadSphere(THREE.LinearFilter, THREE.NearestFilter, -120, 60, 0);
				loadSphere(THREE.LinearFilter, THREE.LinearFilter, 0 ,60, 0);
				loadSphere(THREE.LinearFilter, THREE.NearestMipMapNearestFilter, 120, 60, 0);
				loadSphere(THREE.LinearFilter, THREE.NearestMipMapLinearFilter, -120 , -60, 0);
				loadSphere(THREE.LinearFilter, THREE.LinearMipMapNearestFilter, 0, -60, 0);
				loadSphere(THREE.LinearFilter, THREE.LinearMipMapLinearFilter, 120 , -60, 0);
				console.log(zmeshArray);


			}


			function loadSphere( magFilter, minFilter, x, y, z ) {
				// earth

				earthTexture = THREE.ImageUtils.loadTexture('../../textures/earth_mercator.jpg');
				earthTexture.magFilter = magFilter
				earthTexture.minFilter = minFilter
				earthTexture.repeat.x = 2036/2058;
				earthTexture.repeat.y = 2040/2058;
				earthTexture.offset.x = (1 / 140) * earthTexture.repeat.x;
				earthTexture.offset.y = (1 / 260) * earthTexture.repeat.y;

				textureMaterial = new THREE.MeshBasicMaterial( { map: earthTexture, overdraw: true } );

				sphereGeometry = new THREE.SphereGeometry( 50, 100, 100 );
				sphereMesh = new THREE.Mesh( sphereGeometry, textureMaterial );
				sphereMesh.position.set( x, y, z );
				sphereMesh.scale.set( 1, 1, 1 );
				zmeshArray.push(sphereMesh);
				scene.add( sphereMesh );
			}

			function onDocumentMouseMove(event) {

				mouseX = ( event.clientX - windowHalfX );
				mouseY = ( event.clientY - windowHalfY );
			}

			function animate() {

				requestAnimationFrame( animate );
				render();
			}

			var i = 0;

			function render() {

				angleX = -mouseY/150;
				angleY = -mouseX/150;

				//zmesh.rotation.set(angleX, angleY, 0);
				//zmesh1.rotation.set(angleX, angleY, 0);
				for (var i = 0; i < zmeshArray.length; i++) {
  					zmeshArray[i].rotation.set(angleX, angleY, 0);
				}


				//camera.position.x += angleY;
				webglRenderer.render( scene, camera );
			}

		</script>

	</body>
</html>
