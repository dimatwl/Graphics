<!doctype html>
<html lang="en">
	<head>
		<title>WebGL made easy</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background:#000;
				padding:0;
				margin:0;
				overflow:hidden;
				font-family:'trebuchet ms', 'lucida grande', 'lucida sans unicode', arial, helvetica, sans-serif;
				text-align:center;
			}
			canvas { pointer-events:none; z-index:10; }
			
			p { font-size: small;}

		</style>
	</head>

	<body>

		<div id="container">
			
		</div>
	</body>

	<!-- Shaders -->
	<script type="x-shader/x-vertex" id="vertexshader">
		
		// switch on high precision floats
		#ifdef GL_ES
		precision highp float;
		#endif

		varying float Z;
		
		void main()
		{
			gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
			Z = gl_Position[2];
		}
		
	</script>
	
	<script type="x-shader/x-fragment" id="fragmentshader">
	
		#ifdef GL_ES
		precision highp float;
		#endif

		varying float Z;

		uniform float near;
		uniform float far;
		
		void main()
		{
			float normalized = (Z - near) / (far - near);
			float red = (-normalized * 2.0) + 1.5;
			float green = 0.0;
			float blue = (normalized * 2.0) - 0.5;
			gl_FragColor = vec4(red, green, blue, 1.0);
		}
	
	</script>
	<!-- End Shaders -->

	<script src="../../../js/detector.js"></script>
	<script src="../../../js/three.js"></script>
	
	<script src="../../../js/raf.js"></script>

	<script src="../../../js/jquery-1.8.2.js"></script>

	<script type="text/javascript">
		if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

		var SCREEN_WIDTH = window.innerWidth;
		var SCREEN_HEIGHT = window.innerHeight;
		var FLOOR = 0;

		var container;

		var camera, scene;
		var webglRenderer;

		var zmesh, geometry;

		var mouseX = 0, mouseY = 0;

		var windowHalfX = window.innerWidth / 2;
		var windowHalfY = window.innerHeight / 2;

		var uniforms = {
  			near: {
    			type: 'f', // a float
    			value: 5 // an empty array
  			}, 
  			far: {
  				type: 'f', // a float
    			value: 25 // an empty array
  			}
		};

		var vShader = $('#vertexshader');
		var fShader = $('#fragmentshader');

		var shaderMaterial = new THREE.ShaderMaterial({
			uniforms:     uniforms,
			vertexShader:   vShader.text(),
    		fragmentShader: fShader.text()
		});

		document.addEventListener( 'mousemove', onDocumentMouseMove, false );

		init();
		animate();

		function init() {

			container = document.createElement( 'div' );
			document.body.appendChild( container );
			
			// camera
			camera = new THREE.PerspectiveCamera( 45, SCREEN_WIDTH / SCREEN_HEIGHT, uniforms.near.value, uniforms.far.value );
			camera.position.z = 20;
			camera.position.y = 15;
			
			//scene
			scene = new THREE.Scene();

			// lights
			//var ambient = new THREE.AmbientLight( 0x00000000 );
			//scene.add( ambient );

			// more lights
			var directionalLight = new THREE.DirectionalLight( 0xffeedd );
			directionalLight.position.set( 0, -70, 100 ).normalize();
			scene.add( directionalLight );
			
			// renderer
			webglRenderer = new THREE.WebGLRenderer({antialias: true});
			webglRenderer.setSize( SCREEN_WIDTH, SCREEN_HEIGHT );
			webglRenderer.domElement.style.position = "relative";
			container.appendChild( webglRenderer.domElement );
			
			// loader
			var loader = new THREE.JSONLoader(),
				callbackModel   = function( geometry ) { createScene( geometry,  90, FLOOR, -50, 105 ) };
			loader.load( "../../../js/model.js",  callbackModel );
		}

		function createScene( geometry, x, y, z, b ) {

			zmesh = new THREE.Mesh( geometry, shaderMaterial );
			zmesh.position.set( 0, 16, 0 );
			zmesh.scale.set( 1, 1, 1 );
			scene.add( zmesh );
		}

		function onDocumentMouseMove(event) {

			mouseX = ( event.clientX - windowHalfX );
			mouseY = ( event.clientY - windowHalfY );
		}

		function animate() {

			requestAnimationFrame( animate );
			render();
		}

		function render() {

			zmesh.rotation.set(-mouseY/150 + 1, -mouseX/150, 0);

			webglRenderer.render( scene, camera );
		}

	</script>
</html>
